{% extends 'mainapp/basic.html' %}
{% load static %}


{% block title %}
{% load myfilters %}
StocksWatch - TRACKER
{% endblock title %}


{% block css %}
  .red { color: red; }
  .green { color: green; }
{% endblock css %}


{% block body %}
<div class="container">
<h2>Ativo(s) selecionado(s)</h2>
<table class="table-container">
<table class="table">

    <thead>
      <tr>
        <th scope="col">ID</th>
        <th scope="col">Ativo</th>
        <th scope="col">Pre√ßo</th>
        <th scope="col">Fechamento</th>
        <th scope="col">Abertura</th>
        <th scope="col">Intradia</th>
        <th scope="col">52Wk Range</th>
        <th scope="col">Market Cap</th>
        <th scope="col">Volume</th>
      </tr>
    </thead>

    <tbody>
      {% for key, value in data.items %}
      <tr>
        <th scope="row">{{forloop.counter}}</th>
        <td>{{key}}</td>
        <td id="{{key}}_price">{{ value|get:"Quote Price"|floatformat:2 }}</td>
        <td id="{{key}}_prevprice">{{ value|get:"Previous Close"|floatformat:2 }}</td>
        <td>{{ value|get:"Open" }}</td>

        <td id="{{key}}_change">
          <script>
            var change = document.getElementById("{{key}}_price").innerHTML - document.getElementById("{{key}}_prevprice").innerHTML;
            change = Number((change).toFixed(4));
            if(change >= 0){
              document.getElementById("{{key}}_change").className = "green";
            }
            if (change < 0){
              document.getElementById("{{key}}_change").className = "red";
            }
            document.getElementById("{{key}}_change").innerHTML = change;
          </script>
        </td>

        <td>{{ value|get:"52 Week Range" }}</td>
        <td>{{ value|get:"Market Cap" }}</td>
        <td>{{ value|get:"Volume" }}</td>
      </tr>
      {% endfor %}
    </tbody>

</table>
</table>
<a class="btn btn-primary btn-sm d-grid gap-2" 
        href="{% url 'create-alert' %}">Criar Alerta</a>

{% comment %} ----WIP---- {% endcomment %}
<form class="form-control">
  {% csrf_token %}
  <select class="form-select form-select-lg mb-3 gap-2">
    <option selected>Escolha um ativo:</option>
    {% for key, value in data.items %}
      <option name={{key}} type="text" value={{forloop.counter}}>{{ key }}</option>
    {% endfor %}
  </select>

  <div class="d-grid gap-2">
    <a class="btn btn-primary" href="{% url 'graph' %}">Grafico</a>
  </div>
</form>

</div>
{% endblock body %}